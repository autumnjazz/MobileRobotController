package robotpackage;

import basic.Point;
import mappackage.DynamicMap;
import repositorypackage.Repository;
import sensorpackage.*;

public class Robot implements SIM{
	Point current;
	ColorBlobSensor cs = new ColorBlobSensor();
	HazardSensor hs = new HazardSensor();
	PositionSensor ps = new PositionSensor();
	Repository repo;
	
	public Robot (Repository repo) {
		this.repo = repo;
	}
	
	public Point getCurrent() {
		current = ps.location(repo);
		return current;
	}
	
	public void setCurrent(int x, int y) {
		current.setPoint(x, y);
	}
	
	public void detectSpot() {
		//detect and update hazard
		Point loc = hs.location(repo);
		boolean hresult = hs.checksensor(loc);
		if(hresult) {
			dm.updateHazard(loc);
			repo.m.setHazard(loc);
		}
		//detect and update colorblob
		boolean[] cresult = cs.checksensorAll(repo);
		for(int i = 0; i<4; i++) {
			if(cresult[i]) {
				Point loc2 = cs.location(repo, i);
				dm.updateColorblob(loc2);
				repo.m.setColorblob(loc2);
			}
		}
	}
	
	public void move() { //잘못된 이동 구현
		Point next = repo.p.getPath(current);
		if(next != null) {
			dm.updateRobot(current, next);
		}
		current = next;
	}
	

	public void printDMap() {
		System.out.println("\nBoard:");
		dm.printBoard();
	}
	
}

